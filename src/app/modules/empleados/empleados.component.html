<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0 fw-bold">Gestión de Empleados</h3>

    <button
      class="btn btn-primary btn-lg"
      data-bs-toggle="modal"
      data-bs-target="#empleadoModal"
      (click)="nuevoEmpleado()"
    >
      <i class="fas fa-user-plus me-2"></i>+ Nuevo Empleado
    </button>
  </div>

  <div class="d-flex justify-content-between mb-4">
    <div class="input-group" style="max-width: 350px">
      <span class="input-group-text bg-light border-end-0">
        <i class="fas fa-search"></i>
      </span>
      <input
        type="text"
        class="form-control border-start-0 ps-0"
        placeholder="Buscar empleado por DNI o Nombre"
        [(ngModel)]="filtro"
      />
    </div>

    <ul class="nav nav-pills">
      <li class="nav-item">
        <a
          class="nav-link"
          [class.active]="vistaActual === 'TODOS'"
          (click)="cambiarVista('TODOS')"
        >
          Todos
        </a>
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          [class.active]="vistaActual === 'VENDEDORES'"
          (click)="cambiarVista('VENDEDORES')"
        >
          Vendedores
        </a>
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          [class.active]="vistaActual === 'TECNICOS'"
          (click)="cambiarVista('TECNICOS')"
        >
          Técnicos
        </a>
      </li>
    </ul>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th *ngIf="vistaActual === 'TODOS'">DNI</th>
          <th>Correo</th>
          <th>Teléfono</th>
          <th *ngIf="vistaActual === 'TECNICOS'">Tipo carro</th>
          <th>Fecha Contratación</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let empleado of empleadosMostrados">
          <td>{{ empleado.id || empleado.empleado_id }}</td>
          <td>{{ empleado.nombre || empleado.nombre_empleado }}</td>
          <td>{{ empleado.apellido || empleado.apellido_empleado }}</td>
          <td *ngIf="vistaActual === 'TODOS'">{{ empleado.dni }}</td>
          <td>{{ empleado.correo || "---" }}</td>
          <td>{{ empleado.telefono || "---" }}</td>
          <td *ngIf="vistaActual === 'TECNICOS'">
            {{ empleado.tipo_carro || "---" }}
          </td>
          <td>{{ empleado.fecha_contratacion || "---" }}</td>

          <td class="text-center">
            <button
              class="btn btn-sm btn-info text-white me-2"
              (click)="editarEmpleado(empleado.id!)"
              *ngIf="vistaActual === 'TODOS'"
            >
              <i class="fas fa-edit"></i> Editar
            </button>

            <button
              class="btn btn-sm btn-warning text-dark me-2"
              (click)="abrirAsignarRolModal(empleado.id!)"
              *ngIf="vistaActual === 'TODOS'"
            >
              <i class="fas fa-user-tag"></i> Asignar Rol
            </button>

            <button
              class="btn btn-sm btn-danger"
              (click)="pedirConfirmacion(empleado.id!)"
              *ngIf="vistaActual === 'TODOS'"
            >
              <i class="fas fa-trash-alt"></i> Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="modal fade" id="empleadoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">{{ modalTitle }}</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <form [formGroup]="empleadoForm" (ngSubmit)="guardarEmpleado()">
        <div class="modal-body row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Nombre</label>
              <input class="form-control" formControlName="nombre" />
            </div>

            <div class="mb-3">
              <label class="form-label">Apellido</label>
              <input class="form-control" formControlName="apellido" />
            </div>

            <div class="mb-3">
              <label class="form-label">DNI</label>
              <input class="form-control" formControlName="dni" />
            </div>
          </div>

          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Correo</label>
              <input class="form-control" formControlName="correo" />
            </div>

            <div class="mb-3">
              <label class="form-label">Teléfono</label>
              <input class="form-control" formControlName="telefono" />
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha Contratación</label>
              <input
                type="date"
                class="form-control"
                formControlName="fecha_contratacion"
              />
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="empleadoForm.invalid"
          >
            <i class="fas fa-save me-2"></i> Guardar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="rolModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning">
        <h5 class="modal-title">Asignar Rol</h5>
      </div>
      <div class="modal-body text-center">
        <p>¿Qué rol desea asignar a este empleado?</p>

        <button class="btn btn-success w-100 mb-2" (click)="asignarVendedor()">
          <i class="fas fa-store me-2"></i> Vendedor
        </button>

        <button
          class="btn btn-info w-100 text-white"
          (click)="asignarTecnico()"
        >
          <i class="fas fa-tools me-2"></i> Técnico
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content text-center p-3">
      <h5>¿Eliminar empleado?</h5>
      <p>Esta acción no se puede deshacer.</p>
      <div class="mt-3">
        <button class="btn btn-danger me-2" (click)="confirmarEliminar()">
          Sí, eliminar
        </button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="messageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Mensaje</h5></div>
      <div class="modal-body text-center">{{ messageModalText }}</div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
      </div>
    </div>
  </div>
</div>
